# 歌词时间轴生成工具 - 键盘时间调整功能

## 🎯 功能概述

为歌词时间轴生成工具实现了全面的键盘操作功能，用户现在可以完全通过键盘快捷键来调整已标记的歌词时间轴，无需使用鼠标拖拽。

## ⌨️ 键盘快捷键

### 基础操作
- **Space**: 播放/暂停音频
- **Ctrl+T**: 在当前播放位置插入新歌词行
- **Ctrl+S**: 保存项目
- **Esc**: 关闭编辑器

### 选择和导航
- **↑ (上箭头)**: 选择上一行歌词
- **↓ (下箭头)**: 选择下一行歌词
- **Delete/Backspace**: 删除当前选中的歌词行

### 时间调整 (核心功能)
- **← (左箭头)**: 将选中行时间向前调整 0.1秒
- **→ (右箭头)**: 将选中行时间向后调整 0.1秒
- **Shift+←**: 将选中行时间向前调整 1秒 (粗调)
- **Shift+→**: 将选中行时间向后调整 1秒 (粗调)
- **Ctrl+←**: 将选中行时间向前调整 0.01秒 (精调)
- **Ctrl+→**: 将选中行时间向后调整 0.01秒 (精调)

### 编辑功能 (新增)
- **Ctrl+Enter**: 编辑当前选中行的歌词文本
- **Ctrl+R**: 修改当前选中行的歌手标记

## 🛠️ 技术实现

### 1. 增强的键盘快捷键系统
- 扩展了 `useKeyboardShortcuts` Hook，支持多种修饰键组合
- 实现了三种精度的时间调整：精细(0.01s)、普通(0.1s)、粗糙(1s)
- 防止在输入框中触发快捷键，避免冲突

### 2. 智能时间约束
- 自动防止歌词行时间重叠
- 确保调整后的时间不会超出音频范围
- 维持歌词行的时间顺序

### 3. 项目状态管理
- 新增选择管理功能：`selectNextLine`、`selectPreviousLine`
- 时间调整功能：`adjustSelectedLineTime`
- 批量时间调整：`batchAdjustTime`
- 自动重新排序和格式化时间戳

### 4. 用户界面增强
- 添加了浮动帮助面板，显示所有键盘快捷键
- 可点击的帮助按钮 (?) 来显示/隐藏快捷键说明
- 视觉反馈：选中行高亮显示

## 📁 修改的文件

### 核心文件
1. **`types.ts`** - 扩展了接口定义，添加新的回调函数类型
2. **`useKeyboardShortcuts.ts`** - 实现完整的键盘快捷键处理逻辑
3. **`useTimelineProject.ts`** - 添加选择管理和时间调整功能
4. **`TimelineEditor.tsx`** - 集成所有新功能并添加帮助界面

### 新增功能
- 三级精度时间调整系统
- 智能时间约束和冲突检测
- 键盘导航和选择管理
- 内置帮助系统

## 🎵 使用流程

1. **加载音频文件**: 选择要制作歌词的音频文件
2. **插入歌词**: 播放音频，在合适位置按 `Ctrl+T` 插入歌词行
3. **编辑歌词文本**: 双击歌词行或按编辑按钮输入歌词内容
4. **调整时间**: 
   - 使用 `↑/↓` 选择要调整的歌词行
   - 使用 `←/→` 进行 0.1秒 精度调整
   - 使用 `Shift+←/→` 进行 1秒 粗调
   - 使用 `Ctrl+←/→` 进行 0.01秒 精调
5. **保存和导出**: `Ctrl+S` 保存项目，使用导出按钮生成 LRC 文件

## 🔧 技术特性

### 性能优化
- 使用 `useCallback` 缓存事件处理函数
- 节流处理高频操作
- 智能重渲染控制

### 用户体验
- 实时视觉反馈
- 防误操作保护
- 直观的键盘快捷键设计
- 内置帮助系统

### 兼容性
- 完全向后兼容现有功能
- 支持标准 LRC 格式
- 支持多歌手标记系统

## 🎯 优势

1. **效率提升**: 纯键盘操作比鼠标拖拽更快更精确
2. **精度控制**: 三级精度调整满足不同场景需求
3. **批量操作**: 支持快速选择和调整多个歌词行
4. **学习成本低**: 直观的快捷键设计，易于记忆
5. **专业级功能**: 满足专业歌词制作的精度要求

## 🚀 未来扩展

- 支持批量选择多行进行统一时间偏移
- 添加撤销/重做功能
- 实现歌词行的复制粘贴
- 支持从现有 LRC 文件导入并编辑

这个键盘时间调整系统大大提升了歌词时间轴编辑的效率和精度，为用户提供了专业级的歌词制作体验。
