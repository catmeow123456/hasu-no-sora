# Hasu no Sora éŸ³ä¹æ’­æ”¾å™¨ - AI åŠ©æ‰‹æŒ‡å—

## ğŸµ é¡¹ç›®æ¦‚è¿°
æ¸©æš–é˜³å…‰é£æ ¼çš„ Web éŸ³ä¹æ’­æ”¾å™¨ï¼Œä¸“ä¸º Hasu no Sora éŸ³ä¹è®¾è®¡ã€‚TypeScript å…¨æ ˆ + Yarn Workspaces Monorepoã€‚

## ğŸ—ï¸ æŠ€æœ¯æ ˆ
- **åç«¯**: Node.js + Express + TypeScript
- **å‰ç«¯**: React 18 + TypeScript + Styled Components + Vite
- **å¼€å‘**: Yarn Workspaces + TSX

## ğŸ“ æ ¸å¿ƒç»“æ„
```
packages/
â”œâ”€â”€ server/src/           # åç«¯æœåŠ¡
â”‚   â”œâ”€â”€ index.ts         # æœåŠ¡å™¨å…¥å£
â”‚   â”œâ”€â”€ types/           # åç«¯ç±»å‹
â”‚   â””â”€â”€ utils/           # musicScanner, lyricsScanner
â””â”€â”€ ui/src/              # å‰ç«¯åº”ç”¨
    â”œâ”€â”€ components/      # React ç»„ä»¶
    â”‚   â”œâ”€â”€ LyricsTimelineEditor/  # æ­Œè¯æ—¶é—´è½´ç”Ÿæˆå·¥å…·
    â”‚   â””â”€â”€ shared/      # å…±äº«ç»„ä»¶
    â”œâ”€â”€ hooks/           # è‡ªå®šä¹‰ Hooks
    â”œâ”€â”€ styles/theme.ts  # è®¾è®¡ç³»ç»Ÿ
    â””â”€â”€ types/           # å‰ç«¯ç±»å‹
music/                   # éŸ³ä¹æ–‡ä»¶å­˜å‚¨
```

## ğŸš€ å¼€å‘å‘½ä»¤
```bash
yarn dev     # å¼€å‘æ¨¡å¼ (å‰åç«¯åŒæ—¶å¯åŠ¨)
yarn build   # æ„å»ºå‰ç«¯
yarn start   # ç”Ÿäº§æœåŠ¡å™¨
```

## ğŸ¨ è®¾è®¡ç³»ç»Ÿ
- **ä¸»è‰²**: #FF8C42 (æš–æ©™) | **æ¬¡è‰²**: #FFD23F (é‡‘é»„) | **å¼ºè°ƒ**: #FF6B9D (ç²‰è‰²)
- **èƒŒæ™¯**: #FFF8F0 (å¥¶æ²¹ç™½) | **å­—ä½“**: Inter/Poppins + Noto Sans SC

## ğŸ¤ å¤šæ­Œæ‰‹æ­Œè¯ç³»ç»Ÿ (æ ¸å¿ƒç‰¹æ€§)

### æ”¯æŒæ ¼å¼
```lrc
[00:12.34]@kozue@å•æ­Œæ‰‹æ­Œè¯
[01:05.44]@kozue@æ··åˆ @kaho@æ­Œæ‰‹ @kozue@æ ‡è®°
[02:05.00]@kaho,tsuzuri,megumi@å½©è™¹æ¸å˜æ•ˆæœ
```

### æ­Œæ‰‹é…è‰² (å…³é”®ä¿¡æ¯)
| ç®€ç§° | è§’è‰² | é¢œè‰² | ç®€ç§° | è§’è‰² | é¢œè‰² |
|------|------|------|------|------|------|
| `kozue` | ä¹™å®—æ¢¢ | #68be8d | `rurino` | å¤§æ³½ç‘ ç’ƒä¹ƒ | #e7609e |
| `kaho` | æ—¥é‡ä¸‹èŠ±å¸† | #f8b500 | `megumi` | è—¤å²›æ…ˆ | #c8c2c6 |
| `sayaka` | æ‘é‡æ²™è€¶é¦™ | #5383c3 | `ginko` | ç™¾ç”ŸåŸå­ | #a2d7dd |
| `tsuzuri` | å¤•é›¾ç¼€ç† | #ba2636 | `kosuzu` | å¾’ç”ºå°é“ƒ | #fad764 |
| `himena` | å®‰å…»å¯ºå§¬èŠ½ | #9d8de2 | `hasunosora` | ä¸»é¢˜è‰² | #FB8A9B |

**å°ç»„**: `cerise` (#da645f), `dollche` (#163bca), `miracra` (#F3B171)

## ğŸ› ï¸ æ­Œè¯æ—¶é—´è½´ç”Ÿæˆå·¥å…·

### æ ¸å¿ƒåŠŸèƒ½
- **éŸ³é¢‘æ³¢å½¢**: Canvas ç»˜åˆ¶ï¼Œæ”¯æŒç‚¹å‡»è·³è½¬
- **å®æ—¶ç¼–è¾‘**: åŒå‡»ç¼–è¾‘æ­Œè¯ï¼Œæ‹–æ‹½è°ƒæ•´æ—¶é—´
- **å¤šæ­Œæ‰‹æ”¯æŒ**: å®Œæ•´çš„æ­Œæ‰‹æ ‡è®°å’Œå½©è™¹æ•ˆæœ
- **å¯¼å‡ºæ ¼å¼**: LRC, Enhanced LRC, JSON, SRT, TXT
- **é”®ç›˜å¿«æ·é”®**: Space(æ’­æ”¾), Ctrl+T(æ’å…¥), Ctrl+S(ä¿å­˜)
- **çŠ¶æ€æ¢å¤**: è‡ªåŠ¨ä¿å­˜å·¥ä½œè¿›åº¦ï¼Œæ”¯æŒè·¨ä¼šè¯æ¢å¤

### ç»„ä»¶æ¶æ„
```
LyricsTimelineEditor/
â”œâ”€â”€ TimelineEditor.tsx      # ä¸»ç•Œé¢
â”œâ”€â”€ AudioWaveform.tsx       # æ³¢å½¢å¯è§†åŒ–
â”œâ”€â”€ LyricLineEditor.tsx     # æ­Œè¯è¡Œç¼–è¾‘
â”œâ”€â”€ SingerTagEditor.tsx     # æ­Œæ‰‹æ ‡è®°ç¼–è¾‘
â”œâ”€â”€ PreviewPanel.tsx        # å®æ—¶é¢„è§ˆ
â”œâ”€â”€ ExportDialog.tsx        # å¯¼å‡ºåŠŸèƒ½
â”œâ”€â”€ RestoreDialog.tsx       # çŠ¶æ€æ¢å¤å¯¹è¯æ¡†
â”œâ”€â”€ utils/
â”‚   â””â”€â”€ audioCache.ts       # éŸ³é¢‘æ–‡ä»¶ç¼“å­˜ç®¡ç†
â””â”€â”€ hooks/                  # è‡ªå®šä¹‰ Hooks
    â”œâ”€â”€ useTimelineProject.ts  # é¡¹ç›®çŠ¶æ€ç®¡ç†ï¼ˆå«æ¢å¤åŠŸèƒ½ï¼‰
    â”œâ”€â”€ useAudioPlayer.ts      # éŸ³é¢‘æ’­æ”¾æ§åˆ¶
    â””â”€â”€ useKeyboardShortcuts.ts # é”®ç›˜å¿«æ·é”®
```

### ğŸ”„ çŠ¶æ€æ¢å¤ç³»ç»Ÿ

#### å­˜å‚¨æ¶æ„
- **localStorage**: é¡¹ç›®å…ƒæ•°æ®ã€æ­Œè¯æ•°æ®ã€è®¾ç½®ä¿¡æ¯
  - é”®å: `timeline_last_project`
  - å†…å®¹: åºåˆ—åŒ–çš„é¡¹ç›®æ•°æ®ï¼ˆä¸å« File å¯¹è±¡ï¼‰
- **IndexedDB**: éŸ³é¢‘æ–‡ä»¶ç¼“å­˜
  - æ•°æ®åº“: `TimelineEditorCache`
  - å­˜å‚¨: éŸ³é¢‘æ–‡ä»¶çš„ ArrayBuffer æ•°æ®

#### æ¢å¤æµç¨‹
1. ç¼–è¾‘å™¨å¯åŠ¨æ—¶æ£€æŸ¥ `timeline_last_project`
2. å¦‚æœå­˜åœ¨ä¿å­˜çš„é¡¹ç›®ï¼Œæ˜¾ç¤º `RestoreDialog`
3. ç”¨æˆ·é€‰æ‹©æ¢å¤æˆ–å¼€å§‹æ–°é¡¹ç›®
4. æ¢å¤æ—¶ä» localStorage åŠ è½½é¡¹ç›®æ•°æ®
5. ä» IndexedDB æ¢å¤éŸ³é¢‘æ–‡ä»¶ File å¯¹è±¡

#### å…³é”®å®ç°
- **éŸ³é¢‘ç¼“å­˜**: `audioCacheManager` å•ä¾‹ç®¡ç† IndexedDB æ“ä½œ
- **åºåˆ—åŒ–å¤„ç†**: File å¯¹è±¡è½¬æ¢ä¸ºå¯åºåˆ—åŒ–çš„å…ƒæ•°æ®
- **é”™è¯¯å¤„ç†**: éŸ³é¢‘æ–‡ä»¶ä¸¢å¤±æ—¶ä¼˜é›…é™çº§
- **ç”¨æˆ·åé¦ˆ**: ä¿å­˜æˆåŠŸ/å¤±è´¥çš„å®æ—¶æç¤º

#### å¼€å‘æ³¨æ„äº‹é¡¹
- ä¸è¦åœ¨ `App.tsx` ä¸­ä¼ å…¥ `initialProject` å‚æ•°ï¼Œä¼šè·³è¿‡æ¢å¤æ£€æŸ¥
- éŸ³é¢‘æ–‡ä»¶é€šè¿‡ `audioCacheManager.cacheAudioFile()` ç¼“å­˜
- æ¢å¤æ—¶éœ€è¦é‡å»º File å¯¹è±¡å¹¶è®¾ç½®åˆ°éŸ³é¢‘æ’­æ”¾å™¨
- ä½¿ç”¨ `checkForSavedProject()` æ£€æŸ¥æ˜¯å¦æœ‰ä¿å­˜çš„é¡¹ç›®

## ğŸ“¡ API æ¥å£
- **è®¤è¯**: å¯†ç  `hasu-no-sora`
- **æ ¸å¿ƒæ¥å£**: `/api/albums`, `/api/albums/:id`, `/audio/:albumName/:filename`, `/api/lyrics/:albumName/:trackFilename`

## ğŸ¯ å¼€å‘æŒ‡å¯¼

### ä»£ç è§„èŒƒ
- **TypeScript**: ä¸¥æ ¼ç±»å‹ï¼Œé¿å… `any`
- **React**: å‡½æ•°ç»„ä»¶ + Hooksï¼Œä½¿ç”¨ `React.memo` ä¼˜åŒ–
- **æ ·å¼**: Styled Components + ä¸»é¢˜ç³»ç»Ÿ
- **æ€§èƒ½**: `useCallback`/`useMemo` ç¼“å­˜

### æ­Œè¯ç»„ä»¶å¼€å‘
- ä½¿ç”¨ `packages/ui/src/components/shared/LyricsSegments.tsx` å…±äº«æ¸²æŸ“é€»è¾‘
- æ”¯æŒ `@æ­Œæ‰‹@æ–‡æœ¬` å’Œ `@æ­Œæ‰‹1,æ­Œæ‰‹2@æ–‡æœ¬` æ ¼å¼
- ä¿æŒå‰åç«¯ç±»å‹å®šä¹‰åŒæ­¥

### æ³¨æ„äº‹é¡¹
- éŸ³ä¹æ–‡ä»¶è·¯å¾„é…ç½®åœ¨ `packages/server/src/index.ts`
- å‰ç«¯é€šè¿‡ Vite ä»£ç†è®¿é—®åç«¯ API
- ä½¿ç”¨ Yarn Workspacesï¼Œæ³¨æ„åŒ…ç®¡ç†å‘½ä»¤
- ä¿æŒè®¾è®¡ç³»ç»Ÿçš„ä¸€è‡´æ€§ï¼Œéµå¾ªæ¸©æš–é˜³å…‰é£æ ¼
